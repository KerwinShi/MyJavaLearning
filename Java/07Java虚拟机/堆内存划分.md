Java堆是被所有线程共享的一块内存区域，所有对象和数组都在堆上进行内存分配。为了进行高效的[垃圾回收](./垃圾回收.md)，虚拟机把堆内存划分成新生代、老年代和永久代（1.8中无永久代，使用metaspace实现）三块区域。  
[JVM堆划分](../../流程图/JVM堆划分.drawio)  


Java虚拟机将堆内存划分为新生代、老年代和永久代  
1.新生代  
-  
>新生成的对象优先存放在新生代中。   
HotSpot将新生代划分为三块，一块较大的Eden（伊甸）空间和两块较小的Survivor（幸存者）空间，默认比例为8：1：1。  
>划分的目的是因为HotSpot采用复制算法来回收新生代，设置这个比例是为了充分利用内存空间，减少浪费。新生成的对象在Eden区分配（大对象除外，大对象直接进入老年代），当Eden区没有足够的空间进行分配时，虚拟机将发起一次Minor GC([垃圾回收](./垃圾回收.md))。

GC的大致流程简述如下：
垃圾回收开始的时候，对象会存在与Eden区与From区，To区是被清空的；Eden区的对象会被复制到To区；From区的根据其年龄进行区分，大于阈值（默认15）的对象放入老年代，小于阈值的复制放入To区；然后，From区与To交换角色，可以开始下一次的垃圾回收。  

2.老年代
-  
在新生代中经历了多次（具体看虚拟机配置的阀值）GC后仍然存活下来的对象会进入老年代中。老年代中的对象生命周期较长，存活率比较高，在老年代中进行GC的频率相对而言较低，而且回收的速度也比较慢。  


3.永久代  
-  
>永久代是HotSpot虚拟机特有的概念（JDK1.8之后为metaspace替代永久代），它采用永久代的方式来实现方法区，其他的虚拟机实现没有这一概念，而且HotSpot也有取消永久代的趋势，在JDK 1.7中HotSpot已经开始了“去永久化”，把原本放在永久代的字符串常量池移出；jdk8中已经彻底移除了永久代，jdk8中引入了一个新的内存区域叫metaspace；永久代是实现层面的东西，永久代里面存的东西基本上就是方法区规定的那些东西。  

永久代存储类信息、常量、静态变量、即时编译器编译后的代码等数据，对这一区域而言，Java虚拟机规范指出可以不进行垃圾收集，一般而言不会进行垃圾回收。  

方法区（Method Area）是jvm规范里面的[运行时数据区](./JVM结构.md)的一个组成部分，主要用来存储class、运行时常量池、字段、方法、代码、JIT代码等，并不是实际的实现。  

***方法区是规范层面的东西，规定了这一个区域要存放哪些东西，永久代或者是metaspace是对方法区的不同实现，是实现层面的东西。***  


参考：  
1.https://www.cnblogs.com/guanghe/p/10524314.html（堆划分）  


